# Upgrade scenario.yaml - network upgrade simulation (compact format)
# Expand with: python3 scripts/scenario_parser.py test_configs/upgrade_scenario_compact.yaml -o monerosim.yaml

general:
  stop_time: 24h
  simulation_seed: 12345
  bootstrap_end_time: auto
  enable_dns_server: true
  shadow_log_level: warning
  progress: true
  runahead: 100ms
  process_threads: 2
  daemon_defaults:
    log-level: 1
    log-file: /dev/stdout
    db-sync-mode: fastest
    no-zmq: true
    non-interactive: true
    disable-rpc-ban: true
    allow-local-ip: true
  wallet_defaults:
    log-level: 1
    log-file: /dev/stdout

network:
  path: gml_processing/1200_nodes_caida_with_loops.gml
  peer_mode: Dynamic

agents:
  # 5 miners - upgrade from v1 to v2
  miner-{001..005}:
    wallet: monero-wallet-rpc
    script: agents.autonomous_miner
    start_time: 0s
    start_time_stagger: 1s
    hashrate: [30, 25, 25, 10, 10]
    can_receive_distributions: true
    # Daemon phases for upgrade
    daemon_0: monerod-v1
    daemon_0_start: auto           # = start_time
    daemon_0_stop: 36000s          # 10h - start of upgrade
    daemon_0_stop_stagger: 30s     # 30s between each agent's upgrade
    daemon_1: monerod-v2
    daemon_1_start: auto           # = daemon_0_stop + 30s gap

  # 20 users - also upgrade
  user-{001..020}:
    wallet: monero-wallet-rpc
    script: agents.regular_user
    start_time: 1200s
    start_time_stagger: 5s
    transaction_interval: 60
    activity_start_time: auto
    can_receive_distributions: true
    # Daemon phases continue stagger from miners
    daemon_0: monerod-v1
    daemon_0_start: auto
    daemon_0_stop: 36000s
    daemon_0_stop_stagger: 30s     # Continues from miner offset (5, 6, 7...)
    daemon_1: monerod-v2
    daemon_1_start: auto

  miner-distributor:
    script: agents.miner_distributor
    wait_time: auto
    transaction_frequency: 30

  simulation-monitor:
    script: agents.simulation_monitor
    poll_interval: 300
